{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block title %}خانه | استودیو نوآوری دیجیتال - خلق آینده{% endblock %}

{% block content %}

<style>
    :root {
        --c-primary: #007BFF;      /* آبی کلاسیک */
        --c-primary-dark: #0056b3;
        --c-secondary: #17a2b8;    /* فیروزه‌ای */
        --c-dark: #343a40;
        --c-text: #495057;
        --c-text-light: #6c757d;
        --c-bg: #ffffff;
        --c-light-bg: #f8f9fa;
        --c-border: #dee2e6;
        --c-success: #28a745;
        --c-error: #dc3545;

        --shadow-soft: 0 4px 15px rgba(0,0,0,0.06);
        --shadow-medium: 0 8px 30px rgba(0,0,0,0.1);
        --radius: 12px;
        --transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }


    .page-wrapper {
        font-family: 'Vazirmatn', sans-serif;
        background-color: var(--c-bg);
        color: var(--c-text);
        line-height: 1.8;
    }
    .container {
        max-width: 1140px;
        margin: 0 auto;
        padding: 0 20px;
    }
    .section {
        padding: 120px 0;
        position: relative;
        overflow: hidden;
    }
    .section-header {
        text-align: center;
        margin-bottom: 70px;
    }
    .section-header h2 {
        font-size: 3rem;
        font-weight: 800;
        color: var(--c-dark);
        margin-bottom: 1rem;
    }
    .section-header p {
        font-size: 1.1rem;
        color: var(--c-text-light);
        max-width: 650px;
        margin: 0 auto;
    }
    .btn {
        display: inline-block;
        padding: 12px 28px;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
        transition: var(--transition);
        border: 2px solid transparent;
        font-size: 1rem;
    }
    .btn-primary {
        background-color: var(--c-primary);
        color: white;
    }
    .btn-primary:hover {
        background-color: var(--c-primary-dark);
        transform: translateY(-3px);
        box-shadow: var(--shadow-medium);
    }


    header {
        position: relative;
        z-index: 1000 !important; /* این خط هدر را همیشه در بالاترین لایه نگه می‌دارد */
    }


    .hero {
        min-height: 90vh;
        display: flex;
        align-items: center;
        text-align: center;
        background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
        background-size: 400% 400%;
        animation: gradientBG 15s ease infinite;
        color: white;
    }
    @keyframes gradientBG {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }
    .hero h1 {
        font-size: 4.5rem;
        font-weight: 900;
        margin-bottom: 1.5rem;
    }
    .hero p {
        font-size: 1.25rem;
        max-width: 700px;
        margin: 0 auto 2.5rem;
        opacity: 0.9;
    }


    .services-tabs-wrapper {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 50px;
        align-items: flex-start;
    }
    .service-tabs {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .service-tab-button {
        width: 100%;
        padding: 20px;
        background: var(--c-white);
        border: 1px solid var(--c-border);
        border-radius: var(--radius);
        text-align: right;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .service-tab-button.active,
    .service-tab-button:hover {
        background-color: var(--c-primary);
        color: white;
        border-color: var(--c-primary);
        transform: translateX(-10px);
    }
    .service-tab-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: center;
    }
    .service-tab-content h3 {
        font-size: 2rem;
        font-weight: 700;
        color: var(--c-dark);
        margin-bottom: 1rem;
    }
    .service-tab-content img {
        width: 100%;
        border-radius: var(--radius);
        box-shadow: var(--shadow-medium);
    }

    /* ---------------------------------------------- */
    /* 6. بخش پروژه‌ها با افکت سه‌بعدی       */
    /* ---------------------------------------------- */
    .projects-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        perspective: 1000px;
    }
    .project-card {
        background: var(--c-white);
        border-radius: var(--radius);
        box-shadow: var(--shadow-soft);
        transition: var(--transition);
        transform-style: preserve-3d;
    }
    .project-card:hover {
        box-shadow: var(--shadow-medium);
    }
    .project-card-image {
        overflow: hidden;
        border-top-left-radius: var(--radius);
        border-top-right-radius: var(--radius);
    }
    .project-card-image img {
        width: 100%;
        height: 220px;
        object-fit: cover;
    }
    .project-card-content {
        padding: 25px;
    }
    .project-card-content h3 {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--c-dark);
    }


    .testimonial-slider {
        position: relative;
        max-width: 800px;
        margin: 0 auto;
        height: 350px; /* ارتفاع ثابت برای جلوگیری از پرش */
    }
    .testimonial-slide {
        position: absolute;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    .testimonial-quote {
        font-size: 1.5rem;
        font-weight: 500;
        color: var(--c-dark);
        margin-bottom: 2rem;
    }
    .testimonial-author img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        margin: 0 auto 1rem;
    }
    .testimonial-author .name {
        font-weight: 700;
    }
    .testimonial-author .title {
        color: var(--c-text-light);
    }


    .skills-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        max-width: 900px;
        margin: 0 auto;
    }
    .skill-card {
        background: var(--c-white);
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow-soft);
        display: flex;
        align-items: center;
        gap: 15px;
        transition: var(--transition);
    }
    .skill-card:hover {
        transform: translateY(-5px);
        color: var(--c-primary);
    }
    .skill-card img {
        width: 40px;
        height: 40px;
    }
    .skill-card span {
        font-size: 1.1rem;
        font-weight: 600;
    }


    .fade-in { opacity: 0; transition: opacity 1s ease-out; }
    .fade-in.visible { opacity: 1; }
    .fade-up { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
    .fade-up.visible { opacity: 1; transform: translateY(0); }

    @media (max-width: 992px) {
        .services-tabs-wrapper { grid-template-columns: 1fr; }
        .service-tabs { flex-direction: row; overflow-x: auto; }
        .projects-grid { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 768px) {
        .hero h1 { font-size: 3rem; }
        .projects-grid { grid-template-columns: 1fr; }
    }
</style>


<div class="page-wrapper" x-data>

    <section class="hero">
        <div class="container fade-in visible">
            <h1>خلاقیت در کد، زیبایی در طراحی</h1>
            <p>ما مرزهای بین طراحی و تکنولوژی را جابجا می‌کنیم تا محصولاتی خلق کنیم که نه تنها زیبا، بلکه هوشمند و کارآمد هستند.</p>
            <a href="{% url 'portfolio:project-list' %}" class="btn btn-primary">کاوش در پروژه‌ها</a>
        </div>
    </section>

    <section class="section" id="services" x-data="{ activeTab: 1 }">
        <div class="container">
            <div class="section-header fade-up" x-intersect.once="$el.classList.add('visible')">
                <h2>راهکارهای جامع ما</h2>
                <p>از استراتژی تا اجرا، ما در هر مرحله از مسیر دیجیتال شما، با ارائه خدمات تخصصی در کنارتان هستیم.</p>
            </div>
            <div class="services-tabs-wrapper">
                <div class="service-tabs">
                    {% for service in services %}
                    <button class="service-tab-button fade-up" x-intersect.once="$el.classList.add('visible')" :class="{ 'active': activeTab === {{ forloop.counter }} }" @click="activeTab = {{ forloop.counter }}" style="transition-delay: {{ forloop.counter0|mult:100 }}ms;">
                        <img src="{{ service.icon.url }}" alt="" style="width: 24px; height: 24px;">
                        <span>{{ service.name }}</span>
                    </button>
                    {% endfor %}
                </div>
                <div class="service-content">
                    {% for service in services %}
                    <div class="service-tab-content" x-show="activeTab === {{ forloop.counter }}" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-x-4" x-transition:enter-end="opacity-100 transform translate-x-0">
                        <div>
                            <h3>{{ service.name }}</h3>
                            <p>{{ service.description }}</p>
                        </div>
                        <img src="{% if forloop.counter == 1 and featured_projects.0.image %}{{ featured_projects.0.image.url }}{% elif forloop.counter == 2 and featured_projects.1.image %}{{ featured_projects.1.image.url }}{% else %}{% static 'placeholder.jpg' %}{% endif %}" alt="{{ service.name }}">
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <section class="section section--light-bg" id="projects">
        <div class="container">
            <div class="section-header fade-up" x-intersect.once="$el.classList.add('visible')">
                <h2>گالری نوآوری</h2>
                <p>ما به هر پیکسل و هر خط کدی که می‌نویسیم افتخار می‌کنیم. در اینجا منتخبی از بهترین کارهای ما را ببینید.</p>
            </div>
            <div class="projects-grid" x-data="{
                handleMouseMove(e, el) {
                    const { left, top, width, height } = el.getBoundingClientRect();
                    const x = (e.clientX - left) / width;
                    const y = (e.clientY - top) / height;
                    const rotateX = (y - 0.5) * -30;
                    const rotateY = (x - 0.5) * 30;
                    el.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
                },
                handleMouseLeave(el) {
                    el.style.transform = 'rotateX(0) rotateY(0) scale(1)';
                }
            }">
                {% for project in featured_projects|slice:":3" %}
                <a href="{% url 'portfolio:project-detail' slug=project.slug %}" class="project-card fade-up" x-intersect.once="$el.classList.add('visible')" @mousemove="handleMouseMove($event, $el)" @mouseleave="handleMouseLeave($el)" style="transition-delay: {{ forloop.counter0|mult:100 }}ms; text-decoration:none;">
                    <div class="project-card-image"><img src="{{ project.image.url }}" alt="{{ project.title }}"></div>
                    <div class="project-card-content">
                        <h3>{{ project.title }}</h3>
                        <p>{{ project.description|truncatechars:80 }}</p>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- ===== 4. بخش نظرات مشتریان ===== -->
    <section class="section" id="testimonials">
        <div class="container">
            <div class="section-header fade-up" x-intersect.once="$el.classList.add('visible')">
                <h2>صدای مشتریان ما</h2>
            </div>
            <div class="testimonial-slider" x-data="{
                activeSlide: 1,
                totalSlides: {{ testimonials|length }},
                autoplay() {
                    setInterval(() => {
                        this.activeSlide = this.activeSlide === this.totalSlides ? 1 : this.activeSlide + 1;
                    }, 5000);
                }
            }" x-init="autoplay()">
                {% for t in testimonials %}
                <div class="testimonial-slide" x-show="activeSlide === {{ forloop.counter }}" x-transition:enter="transition ease-out duration-1000" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-1000" x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">
                    <p class="testimonial-quote">"{{ t.quote }}"</p>
                    <div class="testimonial-author">
                        <div class="name">{{ t.client_name }}</div>
                        <div class="title">{{ t.client_title }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

</div>

{% endblock %}